Type.registerNamespace("WinDoH.Escher");WinDoH.Escher.Settings=function(a,b){WinDoH.Escher.Settings.initializeBase(this);this.ns=a;this.methodId=b;this._lookupButton=$get(this.get_ns()+"cmdLookup");this._lookupSuccessDelegate=Function.createDelegate(this,this._lookupSuccess);this._lookupFailDelegate=Function.createDelegate(this,this._lookupFail);this._onLoadDelegate=Function.createDelegate(this,this._onLoad);Sys.Application.add_load(this._onLoadDelegate)};WinDoH.Escher.Settings.prototype={get_ns:function(){return this.ns},get_id:function(){return this.methodId},_onLoad:function(b,c){$clearHandlers(this._lookupButton);$addHandlers(this._lookupButton,{click:this._onLookup},this);jQuery("#"+this.get_ns()+"wrapper :input:text").qtip({show:{event:"focus"},hide:{event:"blur"}});var a=this.get_ns();jQuery("#"+a+"dSlideShow").change(function(){if(jQuery(this).val().length==0){jQuery("#"+a+"SlideShowSettings").hide("slow")}else{jQuery("#"+a+"SlideShowSettings").show("slow")}});this._createUpperDowner("tRows","R");this._createUpperDowner("tColumns","C");this._createUpperDowner("tSlideShowSpeed","S");jQuery("<div />").addClass("escher-overlay-bg").appendTo("body");jQuery("#"+this.get_ns()+"overlay").appendTo("body")},_onLookup:function(a,b){a.preventDefault();a.stopPropagation();usernameCtrl=$get(this.get_ns()+"tUsername");if(usernameCtrl.value.length>0){this._displayWait(true);targetCtrl=$get(this.get_ns()+"lAlbumViewer");targetCtrl.innerHTML="";dnn.xmlhttp.callControlMethod("WinDoH.Escher.Settings."+this.get_id(),"LookupAlbums",{username:usernameCtrl.value,datastore:$get(this.get_ns()+"dPhotoStore").value},this._lookupSuccessDelegate,this._lookupFailDelegate)}else{alert("username is required to lookup albums")}},_onUpperDowner:function(src,arg){var targetCtrl=src.target.getAttribute("ohtargetctl");if(targetCtrl){targetCtrl=$get(this.get_ns()+targetCtrl);targetCtrl.value=eval(targetCtrl.value)+eval(src.target.getAttribute("ohmode"))}},getMessage:function(a){return this._msgs[a]},_createChildControl:function(a,b,c){var d=document.createElement(a);if(b){d.id=this.get_ns()+b}if(c){d.type=c}return d},_createImage:function(b,d,a,c){link=this._createChildControl("a");link.href='javascript:ohEscherGallerySelect("'+a+'");';link.title="contains: "+c+" photos";img=this._createChildControl("img");img.src=b;img.border=0;link.appendChild(img);title=this._createChildControl("span");title.innerHTML=d;link.appendChild(title);return link},_createUpperDowner:function(b,c){var d=$get(this.get_ns()+b);if(d){if(!$get(this.get_ns()+c+"up")){var a=this._createChildControl("img",c+"up","img");var e=this._createChildControl("img",c+"down","img");a.src=imgUpSrc;e.src=imgDownSrc;a.setAttribute("ohtargetctl",b);e.setAttribute("ohtargetctl",b);a.setAttribute("ohmode","+1");e.setAttribute("ohmode","-1");d.parentNode.insertBefore(e,d);d.parentNode.appendChild(a);$addHandlers(a,{click:this._onUpperDowner},this);$addHandlers(e,{click:this._onUpperDowner},this)}}},_displayWait:function(a){$get(this.get_ns()+"imgAjax").className=(a?"":"ohHidden")},_lookupSuccess:function(b,e,d){this._displayWait(false);if(!b){alert("Invalid Username!")}else{targetCtrl=$get(this.get_ns()+"lAlbumViewer");targetCtrl.className="escher-albums";targetCtrl.innerHTML="";for(var c=0;c<b.Rows.length;c++){targetCtrl.appendChild(this._createImage(b.Rows[c].Thumb,b.Rows[c].Name,b.Rows[c].Desc,b.Rows[c].Total))}jQuery(".escher-overlay-bg").show();jQuery("#"+this.get_ns()+"overlay").show();var a=this.get_ns();jQuery("body").bind("keyup",function(f){if(f.keyCode==27){jQuery(".escher-overlay-bg").toggle();jQuery("#"+a+"overlay").toggle();jQuery("body").unbind("keyup")}})}},_lookupFail:function(a,c,b){this._displayWait(false)},dispose:function(){$clearHandlers(this._lookupButton);this._lookupButton=null;this._lookupSuccessDelegate=null;this._lookupFailDelegate=null;this._onLoadDelegate=null}};WinDoH.Escher.Settings.registerClass("WinDoH.Escher.Settings",Sys.Component);